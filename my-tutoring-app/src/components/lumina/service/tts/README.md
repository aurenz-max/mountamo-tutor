# TTS Service - Text-to-Speech with Gemini

## Overview

The TTS service provides a unified interface for text-to-speech generation using Gemini TTS.

## Features

- **Gemini TTS Integration**: High-quality text-to-speech using Google's Gemini models
- **Consistent API**: Simple interface for all TTS needs
- **Error Handling**: Graceful degradation with detailed error messages
- **Multiple Voices**: Support for various Gemini voice options

## Setup

### Gemini API Key

Ensure your Gemini API key is configured (should already be set):

```bash
NEXT_PUBLIC_GEMINI_API_KEY=your_gemini_key_here
```

## Usage

### Basic Usage

```typescript
import { generateTTS } from '@/components/lumina/service/tts/ttsService';

// Generate TTS audio using Gemini
const result = await generateTTS("Hello, this is a test.");

if (result.audioBase64) {
  console.log(`Audio generated by ${result.provider}`);
  // Use the base64 audio data
} else {
  console.error(`TTS failed: ${result.error}`);
}
```

### Specify Voice

```typescript
// Use a specific Gemini voice
const result = await generateTTS("Hello!", { voice: 'Kore' });

// Explicit provider (both 'gemini' and 'auto' use Gemini)
const result = await generateTTS("Hello!", { provider: 'gemini', voice: 'Fenrir' });
```

### Backward Compatible Functions

```typescript
// These functions work the same way
import { generateAudioSegment, generateTTSAudio } from '@/components/lumina/service/tts/ttsService';

const audioBase64 = await generateAudioSegment("Hello!");
```

## Voices

### Available Gemini Voices
- `Fenrir` - Deep, engaging voice (default)
- `Kore` - Clear, warm voice
- `Aoede` - Friendly, expressive voice
- `Puck` - Energetic, playful voice

## Rate Limits

### Gemini TTS
- **Free tier**: 10 requests per minute per model
- **Error**: Returns 429 status code with quota exceeded message
- **Recommendation**: Monitor usage and consider paid tiers for production

## Audio Format

Gemini TTS outputs **PCM audio** at **24kHz, 16-bit, mono** encoded as base64 strings.

## Error Handling

The service returns a `TTSResult` object with the following structure:

```typescript
{
  audioBase64: string | null;  // Base64 audio data or null if failed
  provider: 'gemini';  // Always 'gemini'
  error?: string;  // Error message if generation failed
}
```

## Implementation Details

### Files Using TTS Service

The following files use the TTS service:

- ‚úÖ `service/media-player/gemini-media-player.ts`
- ‚úÖ `service/literacy/gemini-listen-and-respond.ts`
- ‚úÖ `service/literacy/gemini-phonics-blender.ts`
- ‚úÖ All literacy primitives with audio features

## Monitoring

The service logs TTS operations to the console:

```
üé§ Attempting Gemini TTS...
‚úÖ Gemini TTS succeeded
```

Or on failure:

```
üé§ Attempting Gemini TTS...
‚ùå Gemini TTS failed: [error message]
```

## Troubleshooting

### Gemini Rate Limit Errors
- Free tier has 10 requests per minute
- Monitor console logs to track usage
- Consider upgrading to a paid Gemini tier for higher limits
- Implement caching strategies to reduce API calls

### No Audio Returned
- Check that the Gemini API key is valid
- Verify the model `gemini-2.5-flash-preview-tts` is accessible
- Review console logs for detailed error messages

### Audio Playback Issues
- Ensure proper base64 decoding
- Verify audio player supports PCM format at 24kHz
- Check browser console for playback errors
